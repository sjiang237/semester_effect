---
title: "Visualizations_of_three_datasets"
author: "Shuheng Jiang"
date: "2024-10-11"
output: html_document
---
## Set up
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

### Handle conflicts
```{r}
#| message: false
options(conflicts.policy = "depends.ok")
devtools::source_url("https://github.com/jjcurtin/lab_support/blob/main/fun_ml.R?raw=true")
tidymodels_conflictRules()
# We also will need to resolve a new conflict using the following code
# Alternatively, John demonstrates code you can use when you load this library to prevent conflicts
conflictRules("Matrix", mask.ok = c("expand", "pack", "unpack"))
```

### Load required packages 
```{r}
#| message: false
#| warning: false
library(kableExtra, exclude = "group_rows") # for displaying formatted tables w/ kbl()
library(janitor, include.only = c("clean_names", "tabyl"))
library(cowplot, include.only = "plot_grid")
library(tidyverse) # for general data wrangling
library(tidymodels) # for modeling
library(kknn)
library(discrim, exclude = "smoothness")
library(xfun, include.only = "cache_rds")
library(cowplot, include.only = "plot_grid")
library(readxl)
library(dplyr)
library(lubridate)
library(skimr)
library(tidyselect)
library(tibble)
library(effectsize)
library(ggpubr)
devtools::install_github("NegativePotato/latltools")
library(latltools)
```


### Source function scripts
```{r}
#| message: false
devtools::source_url("https://github.com/jjcurtin/lab_support/blob/main/fun_plots.R?raw=true")
devtools::source_url("https://github.com/jjcurtin/lab_support/blob/main/fun_eda.R?raw=true")
source("C:/Users/16089/OneDrive/Desktop/lab psych610/610710_functions.R")
```

### Specify other global settings
```{r}
#| include: false
theme_set(theme_classic())
options(tibble.width = Inf, dplyr.print_max=Inf)
```

### file path
```{r}
file_path <- "C:/Users/16089/OneDrive/Desktop/Capstone_Project/semester_effect/raw_data_3"
figure_path <- "C:/Users/16089/OneDrive/Desktop/Capstone_Project/semester_effect/figures_3"
```

### reading in data
```{r}
d_try <- read_csv(here::here(file_path, "Clean_2021_EY_FYP.csv"), 
                   col_types = cols())
```

```{r}
d_try_2 <- read_csv(here::here(file_path, "Clean_2022_LA_Patterns_FYP.csv"), 
                   col_types = cols())
```

```{r}
d_try_3 <- read_csv(here::here(file_path, "clean_ac_2021_wmgf_raw.csv"), 
                   col_types = cols())
```

### Cleaning the data


```{r}
d_try <- d_try[!is.na(d_try$days_since_semester_start), ]
range(d_try$days_since_semester_start)
```
```{r}
d_try_2 <- d_try_2[!is.na(d_try_2$days_since_semester_start), ]
range(d_try_2$days_since_semester_start)
```
```{r}
hist(d_try$days_since_semester_start)
# Do not know why there are no beginning of the semester data
```



```{r}
head(d_try[order(d_try$days_since_semester_start), ], n = 50) 
```


```{r}
hist(d_try_2$days_since_semester_start)
```

remove outliers
```{r}
tail(d_try_2[order(d_try_2$days_since_semester_start), ], n = 50) # 10 highest values
```

```{r}
hist(d_try_3$days_since_semester_start)
```

```{r}
d_try_2$first_day_of_the_semester[d_try_2$semester_id == "summer-8_2020" & is.na(d_try_2$first_day_of_the_semester)] <- "2022-06-20"
```

```{r}
d_try_2$date <- as.Date(d_try_2$date)
d_try_2$first_day_of_the_semester <- as.Date(d_try_2$first_day_of_the_semester)

# Calculate the difference and fill in the 'days_since_semester_start' column
d_try_2 <- d_try_2 |>
mutate(days_since_semester_start = round(as.numeric(difftime(date, first_day_of_the_semester, units = "days"))))
```


```{r}
hist(d_try_2$days_since_semester_start)
```



## Visualization of DataSet_6

```{r}
range(d_try$metacognition)
```
```{r}
range(d_try$days_since_semester_start)
```
Ask whether need to start with day 0 

### semester effect on metacognition
```{r}
mod_1 <- lm(metacognition ~ days_since_semester_start, data = d_try)
anova(mod_1) %>% eta_squared()

plot_meta_complete <- ggplot(d_try, aes(x = days_since_semester_start, y = metacognition)) +
  geom_point() +
  geom_smooth(method = "lm", color = "red", se = TRUE) +
  theme_bw(base_size = 14) + 
  labs(x = 'Days since semester starts when completed the survey', 
       y = 'MetaCognition Score', 
       title = 'Semester Effect on MetaCognition Score') +
  xlim(0, 110) +
  ylim(30, 100) +
  stat_cor(color = "red", size = 6) 

ggsave(plot = plot_meta_complete, 
       filename = file.path(figure_path, 'plot_meta_complete.png'), 
       height = 5.5, width = 5.5,
       units = 'in')  
```


```{r}
save_plot(plot = plot_meta_complete, file_name_full_no_ext = file.path(figure_path, "plot_meta_complete"), width = 7, height = 7, units = 'in')
```

### semester effect on metacognitive_motivations

```{r}
range(d_try$metacognitive_motivations)
```

```{r}
mod_2 <- lm(metacognitive_motivations ~ days_since_semester_start, data = d_try)
anova(mod_2) %>% eta_squared()

plot_metamotive_complete <- ggplot(d_try, aes(x = days_since_semester_start, y = metacognitive_motivations)) +
  geom_point() +
  geom_smooth(method = "lm", color = "red", se = TRUE) +
  theme_bw(base_size = 14) + 
  labs(x = 'Days since semester starts when completed the survey', 
       y = 'Metacognitive Motivations Score', 
       title = 'Semester Effect on MetaCognitive Motivations Score') +
  xlim(0, 110) +
  ylim(10, 50) +
  stat_cor(color = "red", size = 6) 

ggsave(plot = plot_metamotive_complete, 
       filename = file.path(figure_path, 'plot_metamotive_complete.png'), 
       height = 5.5, width = 5.5,
       units = 'in')  
```

```{r}
save_plot(plot = plot_metamotive_complete, file_name_full_no_ext = file.path(figure_path, "plot_metamotive_complete"), width = 7, height = 7, units = 'in')
```


### semester effect on metacognitive_skills
```{r}
range(d_try$metacognitive_skills)
```

```{r}
mod_3 <- lm(metacognitive_skills ~ days_since_semester_start, data = d_try)
anova(mod_3) %>% eta_squared()

plot_metaskills_complete <- ggplot(d_try, aes(x = days_since_semester_start, y = metacognitive_skills)) +
  geom_point() +
  geom_smooth(method = "lm", color = "red", se = TRUE) +
  theme_bw(base_size = 14) + 
  labs(x = 'Days since semester starts when completed the survey', 
       y = 'Metacognitive Skills Score', 
       title = 'Semester Effect on MetaCognitive Skills Score') +
  xlim(0, 110) +
  ylim(10, 60) +
  stat_cor(color = "red", size = 6) 

ggsave(plot = plot_metaskills_complete, 
       filename = file.path(figure_path, 'plot_metaskills_complete.png'), 
       height = 5.5, width = 5.5,
       units = 'in')  
```


```{r}
save_plot(plot = plot_metaskills_complete, file_name_full_no_ext = file.path(figure_path, "plot_metaskills_complete"), width = 7, height = 7, units = 'in')
```
### semester effect on 



## Save CSV
```{r}
d_try |> write_csv(here::here(file_path, "Clean_2021_EY_FYP.csv"))
d_try_2 |> write_csv(here::here(file_path, "Clean_2022_LA_Patterns_FYP.csv"))
d_try_3 |> write_csv(here::here(file_path, "clean_ac_2021_wmgf_raw.csv"))
```

